<!DOCTYPE html>
<html lang="ja">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<%= javascript_pack_tag 'application','data-turbolinks-track': 'reload'%>
<br>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>材料登録2</title>
</head>
<body>
<div class="overlay">
  <div class="close_btn">
    <%= link_to "/recipes/index" do %><i class="fas fa-times"></i><%end%>
  </div>
    <div class="new_ingredients_table">
      <div class="section_title">Add　Material</div>
      <div class="main_contents">
        <div class="explanation">
          <p>未登録の食材を登録するためにカテゴリーから類似する食材を選択し、分量を入力して登録してください。</p>
        </div>
        <div class="main_sections">
          <!-- 材料登録されていない分量のリスト-->
          <div class="unregistered_materials_list">
            <div class="list_title">未登録の食材</div>
              <table class="ingredients_list">
                <%@ingredients.each do |m|%>
                  <% @foodlist = Food.where("name LIKE ? OR keyword LIKE ?","%#{m.foodname}%","%#{m.foodname}%")%>
                    <%if @foodlist.empty?%>
                      <tr>
                        <td><%= check_box_tag :check%></td>
                        <td><%= m.foodname%></td>
                        <td><%= m.amount%></td>
                      </tr>
                    <%end%>
                <%end%>
              </table>
          </div>
          <!-- 材料リストの追加 -->
          <div class="add_material">
              <%=form_with url:"/recipes/create_manual_materials", id:"add_form" ,class:"add_form" do |f| %>
                <table class="add_material_table">
                  <tr>
                    <td><%= f.select :category, @category_parent_array, {}, {class: 'listing-select-wrapper__box--select', id:'parent_category'}%></td>
                    <td><div class ="listing-product-detail__category"></div></td>
                  </tr>
                </table>
                
                分量：<%= f.text_field :amount, size:30 ,class:"amount_form"%></td>
              
                
                <%= f.hidden_field :kind, value: "new_material" %>
                <%= f.hidden_field :recipe_id, value: params[:id] %>
                <%= f.button type:"submit",class:"add_material_btn" do %><i class="fas fa-folder-plus"></i>　Add<%end%>
              <%end%>
          </div>
        </div>
    <%= link_to "/recipes/#{params[:id]}",class:"recipe_show_link" do %><i class="fas fa-clipboard-list"></i> Complete<%end%>
</div>
</body>

<!--
<script>
  $ (function(){
    
    //子カテゴリー,セレクトボックスの選択
    function appendOption(child){
      //value="${category.name}"については、ストロングパラメーターでの値の取り方によってcategory.idの場合もあると思います。
      var html = `<tr><td>
                    <input type="radio" value="${child.id}" name="food_id" class="listing-select-wrapper__box--select" id="child_category" form="create_manual_materials">${child.name}
                  </td></tr>`;
      return html;
    }
    
    //子カテゴリーのビュー作成
    function appendChildrenBox(insertHTML){
      var childSelectHtml = '';
      childSelectHtml = `<div class='listing-select-wrapper__added' id= 'children_wrapper'>
                          <div class='listing-select-wrapper__box'>
                          <table>
                              ${insertHTML}
                          </table>
                          </div>
                        </div>`;
      $('.listing-product-detail__category').append(childSelectHtml);
    }

    //親カテゴリーが選択された時の処理（子カテゴリーの表示）
    $("#parent_category").on('change', function(){
      //選択された親カテゴリーの値を取得
      var parentCategory = document.getElementById('parent_category').value;
      //選択された親カテゴリーが"---"（初期設定）のままだとfalse、変わっているとtrue
      if (parentCategory != "---"){
        $.ajax({
          url: '/recipes/show_food_choices_by_category/get_category_children',
          type: 'GET',
          //コントローラーに飛ばす値です。
          data: { category: parentCategory },
          dataType: 'json'
        })
        .done(function(children){
          //まず、既に表示されている子カテゴリーを削除
          $('#children_wrapper').remove();
          //insertHTMLという変数にカテゴリーのセレクトボックスの選択肢を入れる。（一番最初の段落で設けた変数）
          var insertHTML = '';
          children.forEach(function(child){
            insertHTML += appendOption(child);
          });
          //2段落目で設定した子カテゴリーのビューの呼び出し
          appendChildrenBox(insertHTML);
        })
        .fail(function(){
          alert('カテゴリー取得に失敗しました');
        })
      }else{
        $('#children_wrapper').remove();
      }
    });
  });
</script>
-->
</html>